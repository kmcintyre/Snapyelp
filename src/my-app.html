<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">

<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<link rel="import" href="shared-styles.html">

<link rel="import" href="my-websocket.html">
<link rel="import" href="my-funnels.html">
<link rel="import" href="my-tests.html">
<link rel="import" href="my-index.html">

<link rel="import" href="redux-mixin.html">

<dom-module id="my-app">
   <template>
      <style include="shared-styles iron-flex iron-flex-alignment">
      	:host {
      		
      	}
      	paper-toolbar {
      		background-color: #8D9096;
      		color: white
      	}
      	my-websocket {
      		min-height: 100px;
      	}
      	.hidden {
      		display:none;
      	}
      	.toolbar-tools > ::slotted(.title) {
      		@apply(--layout-horizontal);
      	}
      </style>
      
      <a href="https://github.com/kmcintyre/Snapyelp"><img style="position: absolute; top: 0; right: 0; border: 0; z-index:1" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>
      
      <my-websocket></my-websocket>
      
      <paper-toolbar>
      		<paper-icon-button slot="top" icon="{{ creator_icon(creator) }}" on-tap="creator_toggle"></paper-icon-button>
  			<div slot="top" class="title">
  				<div class="layout horizontal">
	  				<span>
	  					Funnel Creator
	  				</span>
	  				<div class="flex"></div>
	  				<div>
	  					{{ funnels.length }}
	  				</div>
					<div class="flex"></div>
  				</div>
  			</div>  
	  </paper-toolbar>
	        
      <my-index id="creator"></my-index>            
      <div id="creator_space" class="hidden">&nbsp;</div>
      
      <my-funnels></my-funnels>

	  <div hidden$="{{ !visible(tests) }}">
		  <paper-toolbar>
	      		<paper-icon-button slot="top" icon="{{ results_icon(results) }}" on-tap="results_toggle"></paper-icon-button>
	  			<div slot="top" class="title">Test Results</div>  			  			
		  </paper-toolbar>
	  	  <my-tests id="results"></my-tests>
	  </div>
   </template>
   <script> 	    
   class MyApp extends ReduxMixin(Polymer.Element) {
       static get is() {
           return 'my-app';
       }
       
       static get properties() {
    	   return {
        		results: {
					type: Boolean,
        			value: false
				},			
				creator: {
					type: Boolean,
        			value: false
				},				
    			tests: {
					type: Array,
        			statePath: 'tests'
				},
    			funnels: {
					type: Array, 
        			statePath: 'funnels'
				}				
         	}
       }
       
       results_icon(c, button) {
   	   		return this.results ? 'add' : 'remove'
       }
       results_toggle(e) {
  	   		if ( this.$.results.classList.contains('hidden') ) {
      			this.$.results.classList.remove('hidden')
  			} else {
  				this.$.results.classList.add('hidden')
  			}
  			this.results = !this.results;    	   
       }       
       creator_icon(c) {
    	   	return this.creator ? 'add' : 'remove'
       }
       creator_toggle(e) {
    	    ['creator', 'creator_space'].forEach(c => {
    	    	if ( this.$[c].classList.contains('hidden') ) {
    	    		this.$[c].classList.remove('hidden')
      			} else {
      				this.$[c].classList.add('hidden')
      			}	
    	    })
   	   		this.creator = !this.creator;
       }
       visible(tests) {
   	   		return tests.length > 0;
       }       
       ready() {    	  
           super.ready();
           this.set('funnels', this.getState().funnels)
           console.log(MyApp.is, this.funnels)
       }     	       
   }
   customElements.define(MyApp.is, MyApp);
   </script>
</dom-module>